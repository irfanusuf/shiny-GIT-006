@model P1WebMVC.Models.ViewModels.ExploreViewModel


@* explore view model  class is a data view model for this page  *@

@{
  ViewData["Title"] = "Dashboard";
}


<style>
  .img_container {
    border: 1px solid grey;
    width: 100px;
    height: 100px;
    border-radius: 100%;
  }

  .image_thumbnail {
    width: 100px;
    height: 100px;
    border-radius: 100%;
  }
</style>


<div class="container">


  @if (Model.LoggedInUser != null)
  {

    <div>

      <div class="d-flex align-items-center mt-3">

        <div class="img_container">

          @{
            if (Model.LoggedInUser.ProfilePic == null)
            {
              <img class="img-thumbnail image_thumbnail"
                src="https://res.cloudinary.com/dbo0xmbd7/image/upload/v1757921401/P1WEBMVC/Screenshot_From_2025-09-15_12-58-26.png" />
            }
            else
            {
              <img class="img-thumbnail image_thumbnail" src="@Model.LoggedInUser.ProfilePic" />
            }
          }
        </div>

        <h3 class="ms-3"> @Model.LoggedInUser.Username.ToUpper() </h3>

      </div>

      <div class="d-flex align-items-center">
        <form class="w-25 mt-3" method="post" enctype="multipart/form-data" asp-controller="User"
          asp-action="UploadProfile">

          <input class="form-control" type="file" name="image" />
          <button class="btn btn-sm btn-secondary mt-2">

            @{
              if (Model.LoggedInUser.ProfilePic != null)
              {
                <span> Update Profile pic</span>
              }
              else
              {
                <span> Upload profile pic</span>
              }
            }
          </button>
        </form>
      </div>
      <!-- Button trigger modal -->
      <button type="button" class="mt-3 btn btn-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#exampleModal">
        Add Post
      </button>
      <!-- Modal -->
      <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="exampleModalLabel">Upload your Post</h1>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
              <form method="post" enctype="multipart/form-data" asp-controller="Post" asp-action="CreatePost"
                asp-route-userId="@Model.LoggedInUser.UserId">

                <div class="mb-3">
                  <input type="file" class="form-control" name="image" />
                </div>
                <textarea class="form-control" name="PostCaption"> Your Caption   </textarea>
                <button type="submit" class="btn btn-sm btn-secondary mt-3"> Upload </button>
              </form>
            </div>


            @* <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary"></button>
        </div> *@
          </div>
        </div>
      </div>

    </div>

  }




  <div class=" mt-5">
    <div class="d-flex gap-3 justify-content-center">
      @{
        @if (Model.Posts != null && Model.LoggedInUser != null)
        {
          foreach (Post post in Model.Posts)
          {
            <div>
              <img src="@post.PostpicURL" width="400" height="400" />

              <div class="d-flex gap-3">

                <div>

                  @if (post.Likes.Contains(Model.LoggedInUser))
                  {
                    <a href="/post/Removelike?postId=@post.PostId">
                      <i class="bi bi-suit-heart-fill text-danger  " style="font-size: 22px; font-style : bold"></i>
                    </a>
                  }
                  else
                  {
                    <a href="/post/like?postId=@post.PostId">
                      <i class="bi bi-suit-heart text-danger  " style="font-size: 22px; font-style : bold"></i>
                    </a>
                  }

                  <p class="mb-0 ms-1 " style="font-weight : 500"> @post.Likes.Count </p>

                </div>


                <div data-bs-toggle="modal" data-bs-target="#Modal-@post.PostId">
                  <i class="bi bi-chat-square-dots text-success  " style="font-size: 22px; font-style : bold"></i>
                  <p class="mb-0 ms-1" style="font-weight : 500"> @post.Comments.Count </p>
                </div>

                <!-- Modal -->
                <div class="modal fade" id="Modal-@post.PostId" tabindex="-1" aria-labelledby="exampleModalLabel"
                  aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h1 class="modal-title fs-5" id="exampleModalLabel"> @post.User?.Username</h1>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                      </div>


                      <div class="modal-body">

                        <img src="@post.PostpicURL" width="460" height="460" />

                        <p class="w-100"> @post.PostCaption </p>


                        <div class="mt-3">

                          @if (post.Comments.Count > 0)
                          {

                            <p> Comments </p>

                            @foreach (Comment comment in post.Comments)
                            {

                              <div class="d-flex">
                                <div style="border : 1px solid grey ;border-radius : 100% ; width : 30px ; height :30px;"> </div>
                                <p class="ms-2 text-muted"> @comment.CommentText </p>
                              </div>
                            }

                          }
                          else
                          {
                            <div class="d-flex justify-content-center">
                              <p class="text-muted"> No Comments yet </p>
                            </div>
                          }
                        </div>

                        <form method="post" asp-controller="Post" asp-action="AddComment" asp-route-postId="@post.PostId">

                          <input class="form-control" placeholder="Your thoughts" name="CommentText" />

                          <button type="submit" class="btn btn-sm btn-secondary mt-3"> Comment </button>

                        </form>


                  </div>

                    </div>
                  </div>
                </div>



              </div>
              <p class="text-muted mt-2"> @post.PostCaption </p>
            </div>
          }
        }
        else
        {
          <div> No Post Yet </div>
        }
      }
    </div>
  </div>

</div>